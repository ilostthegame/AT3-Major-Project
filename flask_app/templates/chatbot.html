{% extends "base-loggedin.html" %}
{% block content %}
<div class="container mt-4">
    <h3>Helper Chatbot</h3>
    <div id="chatbox" style="border:1px solid #ccc; padding:1em; height:300px; overflow-y:auto; margin-bottom:1em;"></div>
    <form id="chat-form"> <!-- TODO: Use Flask-WTF -->
        <input type="text" id="user-input" class="form-control" placeholder="Type your question..." autocomplete="off">
        <button type="submit" class="btn btn-primary mt-2">Send</button>
    </form>
</div>
<script>
document.getElementById('chat-form').onsubmit = async function(e) {
    e.preventDefault();
    const input = document.getElementById('user-input');
    const chatbox = document.getElementById('chatbox');
    const userMsg = input.value;
    chatbox.innerHTML += `<div><b>You:</b> ${userMsg}</div>`;
    input.value = '';
    const response = await fetch('/chatbot_ask', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({message: userMsg})
    });
    const data = await response.json();
    chatbox.innerHTML += `<div><b>Bot:</b> ${data.reply}</div>`;
    chatbox.scrollTop = chatbox.scrollHeight;
};
</script>
{% endblock %}